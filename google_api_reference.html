JS: (run this when we implement the get request for homepage)
let map;
let infoWindow;
const markers = [];

async function initMap() {
  const { Map, InfoWindow } = await google.maps.importLibrary("maps");
  const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
  const { Place } = await google.maps.importLibrary("places");

  const universityOfColorado = { lat: 40.0076, lng: -105.2659 };

  map = new Map(document.getElementById("map"), {
    center: universityOfColorado,
    zoom: 15,
    mapId: "DEMO_MAP_ID",
    gestureHandling: "greedy",
  });

  infoWindow = new InfoWindow();

  await findParking(Place, AdvancedMarkerElement);

  const toggleButton = document.getElementById('toggle-sidebar-btn');
  const sidebar = document.getElementById('sidebar');
  toggleButton.addEventListener('click', () => {
    sidebar.classList.toggle('hidden');
    if (sidebar.classList.contains('hidden')) {
        toggleButton.textContent = 'Show List';
    } else {
        toggleButton.textContent = 'Hide List';
    }
  });
}

async function findParking(Place, AdvancedMarkerElement) {
  const request = {
    textQuery: "parking at University of Colorado Boulder",
    fields: ["displayName", "location", "formattedAddress", "businessStatus"],
    locationBias: map.getCenter(),
  };

  try {
    const { places } = await Place.searchByText(request);

    if (places.length) {
      const bounds = new google.maps.LatLngBounds();
      const placeList = document.getElementById("place-list");
      placeList.innerHTML = ''; // Clear previous results

      places.forEach((place) => {
        const marker = new AdvancedMarkerElement({
          map,
          position: place.location,
          title: place.displayName,
        });

        markers.push(marker);

        const listItem = document.createElement("div");
        listItem.className = "place-item";
        listItem.innerHTML = `
          <h3>${place.displayName}</h3>
          <p>${place.formattedAddress}</p>
        `;
        placeList.appendChild(listItem);

        const openInfoWindow = () => {
          infoWindow.close();
          const content = document.createElement('div');
          content.className = 'info-window-content';
          content.innerHTML = `
            <h3>${place.displayName}</h3>
            <p><strong>Address:</strong> ${place.formattedAddress}</p>
            <p><strong>Status:</strong> ${place.businessStatus || 'N/A'}</p>
            <p><strong>Availability:</strong> Data not available</p>
          `;
          infoWindow.setContent(content);
          infoWindow.open(map, marker);
        };

        marker.addListener("click", openInfoWindow);
        listItem.addEventListener("click", openInfoWindow);

        bounds.extend(place.location);
      });

      map.fitBounds(bounds);
    } else {
        showError("No parking locations found.");
    }
  } catch (error) {
    console.error("Place search failed:", error);
    showError("Failed to search for parking locations.");
  }
}

function showError(message) {
    const errorDiv = document.getElementById('error-display');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
}

initMap();
